{
  "hash": "a5b4ef0a4c98475725a3f4d2327d98e4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Pooled swab sampling for pathogen early detection\nauthor: 'Simon Grimm '\ndate: '2024-02-23'\nformat:\n  html:\n    code-fold: true\nfilters:\n  - black-formatter\ncap-location: bottom\ndraft: true\nexecute:\n  freeze: auto\n---\n\n::: {#a8fcd1cb .cell execution_count=1}\n``` {.python .cell-code}\n# Importing packages\nimport seaborn as sns\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom collections import defaultdict\nimport random\nimport math\n```\n:::\n\n\n# Introduction\n\n\nThe NAO aims to detect stealth pathogens at an early stage. Up until, we have have focused much our research on wastewater treatment plant (WTP) samples. While WTP sampling offers some advantages, its limitations include environmental noise, non-human biological material, and low pathogen abundance. The NAO thus also wants to investigate other sampling approaches. To this end we’ve previously researched the promise of air sampling for pathogen early detection, and Will recently created a framework that allows analysis of various types of sampling strategies.\n\nOne promising approach is sampling using nasal, nasopharyngeal (NP), or oropharyngeal (OP) swabs.  When pooled, these samples have several advantages\n\n* 400x higher RA(1%) than wastewater, atleast based on an initial BOTEC, that I have low confidence in.\n* More metadata on individuals that contributed to the sample (because you can have them provide some basic metadata when providing the sample.\n* Potentially less static complexity than wastewater.\n* If pools are large enough, dynamic complexity could also be lower.\n* There is more existing research on swab sampling than on other sample types.\n\nStill, the approach also has downsides:\n\n* If not sampling at an airport, getting wide geographic coverage is harder.\n* Scaling is more expensive than with wastewater, especially increasing the number of samples provided at at given location.\n* Regulatory hurdles are likely higher than when sampling wastewater.\n\n# Pathogen abundance and detection capability\n\n## Pathogen shedding\n\nAmong many types of pathogens, respiratory pathogens are particularly likely to cause future pandemics (Amesh A. Adalja, MD, Matthew Watson, ...). Though different pathogens have different tropism across tissues (SARS-CoV-2 having a wider wider tropism than influenza (Flerlage et al. 2021)), all of them are respiratory pathogens and thus shed in the respiratory tract, which includes the pharynx, mouth, and nose.\n\nIn a swab sampling program we could use different swabs that target any of these sitesm, i.e., the nostrils, the nasopharynx, oropharynx, and the mid-turbinate region[^1]. These sites differ in their comfort of sampling and (probably) in their sensitivity. For instance, nasopharyngeal swabs (NP swabs) would have be far better than other swabs for us to consider them for a sampling program, given that they do not allow self-sampling.\n\nWe will evaluate the performance of different swab types in three ways:\n\n* **Sensitivity**: Is the pathogen present at all?\n* **Viral load**: How much of the pathogen can be measured? This metric is based on the qPCR cycle threshold of quantiative.\n* **Relative abundance**: When performing untargeted sequencing, what is the relative abundance of a pathogen?\n\n[^1]: The mid-turbinate region is the area between the nasal opening (Nares) and the nasopharynx.\n\n### Sensitivity of different swab types\n(Tsang et al. 2021) performed a meta-analysis to evaluate the ability of different swab types in detecting SARS-CoV-2 using qPCR. Swab types included nasal swabs (n=1622), throat swabs (n=388), and pooled nasal and throat swabs (n=719), each of which were compared to nasopharyngeal swabs. Overall, pooled nasal/throat swabs have the best diagnostic performance with sensitivity of 0.97 (0.93-1.00).\n\n\n| Sample Type                  | Sensitivity    | Specificity    | Positive Predictive Value | Negative Predictive Value |\n|------------------------------|----------------|----------------|---------------------------|---------------------------|\n| Nasal swabs (n=1622)         | 0.86 (0.77-0.93) | 0.99 (0.96-1.00) | 0.96 (0.87-1.00)          | 0.95 (0.88-0.99)          |\n| Throat swabs (n=388)         | 0.68 (0-35-0.94) | 0.97 (0.95-0.99) | 0.75 (0.45-0.96)          | 0.96 (0.94-0.98)          |\n| Pooled nasal/throat swabs (n=719) | 0.97 (0.93-1.00) | 0.99 (0.98-1.00) | 0.97 (0.90-1.00)          | 0.99 (0.98-1.00)          |\n: **Table 1: Comparison of different swab sample types.** Adapted from (Tsang et al. 2021). Values are effect sizes under a random effects-model. The gold standard is nasopharyngeal swabs.\n\nNote, though Tsang et al. 2021 reports specificity, this metric isn’t very useful in this context. All studies covered by the review used qPCR to detect SARS-CoV-2. qPCR is generally considered to be very sensitive and specific. Thus, if a patient tests positive in a throat swab qPCR, but negative in nasopharyngeal swab qPCR, this shouldn’t be counted against throat swabs (false positive), but rather against nasopharyngeal swabs.\n\nThe review above gives us binary information about SARS-CoV-2 being present in different swab types. But we are not merely interested in a pathogen being present in a sample, but how abundant said pathogen is. For instance, hroat swabs coming back negative when NP swabs come back positive tells us that pathogen abundance is likely higher in the nasopharynx, but it’s unclear by how much.\n\nGetting a better understanding of this is particularly relevant when pooling samples because higher relative abundance in an individual positive sample will ensure detection even if said sample is pooled with a large number of negative samples. To quantify this difference in absolute pathogen abundance between sample types we can look beyond positive/negative comparisons and instead look at the differences in CT scores within studies that compared swab types.\n\n\n### Viral load in different swab types\n\nMost studies on swab sampling performance treat nasopharyngeal swabs (NP swabs) as the gold standard, against which, nasal (Kojima et al. 2021; Tu et al. 2020), mid-turbinate (Tu et al. 2020; Muller et al. 2021), and combined nasal/oropharyngeal (Desmet et al. 2021) swabs are compared. NP swabs are commonly administered by a healthcare professional and a properly administered test absorbs material from below the inferior turbinate, and the nasopharynx located at the back of the nasal cavity. Given that nasopharyngeal swabs are not easily self-administerable, we will treat it here as the reference by which to compare swab types that could realistically be used in a large-scale surveillance program.\n\n#### Nasal swabs\n\nThe CT value difference for paired NP/{Other} swabs are plotted in Figure 1. The CT value of the comparison swab is subtracted from the NP swab CT value. A lower CT is better, thus, a negative cycle threshold (CT) difference equates to a higher pathogen concentration in the NP swab.\n\n::: {#7a0654d8 .cell execution_count=2}\n``` {.python .cell-code}\n#All CT difference data were calculated in and are taken from https://docs.google.com/spreadsheets/d/1YP4mxT_vxiFwXU5ZuBM4obq_oscfhe05ODWwHFHEznM/\ndf = pd.read_csv('data/2024-03-29-nasal-ct.tsv', sep='\\t', skiprows=1)\ndf.columns = df.columns.str.replace(\", \", \"\\n\")\n\ndf = df.melt(var_name='Study & Comparison', value_name='CT Difference')\n\nmean_ct_diff = df.groupby('Study & Comparison')['CT Difference'].mean().reset_index()\nprint(mean_ct_diff)\nfig = plt.figure(figsize=(8, 3.5))\n\nsns.stripplot(data=df, y='Study & Comparison', x='CT Difference', hue='Study & Comparison',jitter=True, alpha=0.6, zorder=0)\nsns.pointplot(data=mean_ct_diff, y='Study & Comparison', x='CT Difference', linestyles='none', markers='D', color='#36454F', markersize=5, errorbar=None, zorder=1)\n#sns.boxplot(data=df,\n#            showmeans=True,\n#            meanline=True,\n#            meanprops={'color': 'k', 'ls': ':', 'linewidth': 1},\n#            medianprops={'visible': False},\n#            whiskerprops={'visible': False},\n#            zorder=10,\n#            x=\"CT Difference\",\n#            y=\"Study & Comparison\",\n#            showfliers=False,\n#            showbox=False,\n#            showcaps=False)\nplt.legend([],[], frameon=False)\n# drop y axis label\nplt.ylabel('')\nplt.xlabel(u'SARS-CoV-2 qPCR CT Δ (Nasal - Comparison)')\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nxmin, xmax = plt.xlim()\nfor x in 5, 0, -5, -10, -15:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n        continue\n    plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nfor y in 0.5, 1.5, 2.5, 3.5:\n    plt.axhline(y=y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Comparison', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors Nasal Swab', fontsize=10, color='black', ha='center')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\nplt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                           Study & Comparison  CT Difference\n0  Goodall et al. 2022\\nCombined Nasal/Throat       0.629355\n1                 Goodall et al. 2022\\nThroat      -0.989310\n2          Kojima et al. 2020\\nNasopharyngeal       3.899565\n3              Tu et al. 2020\\nNasopharyngeal      -0.378696\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![**Figure 1: Nasal vs Throat, combined nasal/throat, and nasopharyngeal swabs.** Data from Goddall et al. 2022, Kojima et al. 2020, Tu et al. 2020](index_files/figure-html/cell-3-output-2.png){width=780 height=335}\n:::\n:::\n\n\n### NP Swabs (to remove)\n\n::: {#07cc6246 .cell execution_count=3}\n``` {.python .cell-code}\n#All CT difference data were calculated in and are taken from https://docs.google.com/spreadsheets/d/1YP4mxT_vxiFwXU5ZuBM4obq_oscfhe05ODWwHFHEznM/\ndf = pd.read_csv('data/np_ct_differences.tsv', sep='\\t', skiprows=1)\ndf.columns = df.columns.str.replace(\", \", \"\\n\")\n\n\ndf = df.melt(var_name='Study & Comparison', value_name='CT Difference')\n\nfig = plt.figure(figsize=(8, 3.5))\nsns.stripplot(data=df, y='Study & Comparison', x='CT Difference', hue='Study & Comparison', jitter=True)\nplt.legend([],[], frameon=False)\n# drop y axis label\nplt.ylabel('')\nplt.xlabel(u'SARS-CoV-2 qPCR CT Δ (NP - Comparison)')\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in 5, 0, -5, -10, -15:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n        continue\n    plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nfor y in 0.5, 1.5, 2.5, 3.5, 4.5:\n    plt.axhline(y=y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Comparison', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors NP Swab', fontsize=10, color='black', ha='center')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![**Figure 1: Nasal vs Nasopharyngeal., Mid-Turbinate, and combined Oropharyngeal/ Nasal swabs.** Data from Kojima et al. 2020, Tu et al. 2020, Muller et al. 2021, and Desmet et al. 2021.](index_files/figure-html/cell-4-output-1.png){width=820 height=334}\n:::\n:::\n\n\nApart from self-collected mid-turbinate swabs in Tu et al. 2020, NP swabs show equivalent performance to nasal swabs in Kojima et al. 2020, mid-turbinate swabs in Muller et al. 2021, and combined nasal/throat swabs in Desmet et al 2021; and equivalent performance to nasal swabs in Tu et al. 2020. In the same study, nasal swabs prove equivalent to NP swabs. Combined oro-pharyngeal swabs are also equivalent to NP swabs.\n\nStudies that use NP swabs as their gold standard are useful to better understand the performance of other swab types, but NP swabs themselves are not practical for a large-scale pooled sampling programs: NP swabs are notoriously uncomfortable and are commonly administered by a third person. In contrast, nasal or oropharyngeal swabs would be more suitable for self-sampling, which allows far higher testing throughput. Let’s thus look at studies that compare nasal and oropharyngeal swabs.\n\n\n### Mid-turbinate swabs\n\n::: {#201b8abf .cell execution_count=4}\n``` {.python .cell-code}\ndf = pd.read_csv('data/2024-04-02-mt-ct.tsv', sep='\\t', skiprows=1)\ndf_ct = df[\"Tu et al. 2020, Nasopharyngeal\"].to_frame()\n\ndf_ct = df_ct.rename(columns={\"Tu et al. 2020, Nasopharyngeal\": \"CT Difference\"})\ndf_ct['Study & Comparison'] = 'Tu et al. 2020,\\nNasopharyngeal'\n\nmean_ct_diff = df_ct.groupby('Study & Comparison', as_index=False)['CT Difference'].mean()\nprint(mean_ct_diff)\nfig = plt.figure(figsize=(8, 0.75))\n\nsns.stripplot(data=df_ct, y='Study & Comparison', x='CT Difference', hue='Study & Comparison', jitter=True, alpha=0.6, zorder=0)\nsns.pointplot(data=mean_ct_diff, y='Study & Comparison', x='CT Difference', linestyles='none', markers='D', color='#36454F', markersize=5, errorbar=None,zorder=1)\n\nplt.legend([],[], frameon=False)\nplt.ylabel('')\nplt.xlabel(u'SARS-CoV-2 qPCR CT Δ (MT - NT)')\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\n\nx_marks = [-10, -7.5, -5, -2.5, 0, 2.5, 5]\n\nfor x in x_marks:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n        continue\n    plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n    #set ticks\n\nplt.xticks(x_marks)\n\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Nasopharyngeal', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors Mid-Turbinate', fontsize=10, color='black', ha='center')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\nplt.show()\nplt.clf()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                Study & Comparison  CT Difference\n0  Tu et al. 2020,\\nNasopharyngeal      -2.682015\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-5-output-2.png){width=732 height=131}\n:::\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 672x480 with 0 Axes>\n```\n:::\n:::\n\n\n::: {#d05f386f .cell execution_count=5}\n``` {.python .cell-code}\ndf = pd.read_csv('data/2024-04-02-mt-ct.tsv', sep='\\t', skiprows=1)\n\ndf_copy_number =  df[\"Muller et al. 2021, Nasopharyngeal\"].to_frame()\n\ndf_copy_number = df_copy_number.rename(columns={\"Muller et al. 2021, Nasopharyngeal\": \"Genome Copy Number Difference\"})\ndf_copy_number['Study & Comparison'] = \"Muller et al. 2021,\\nNasopharyngeal\"\nmean_genome_diff = df_copy_number.groupby('Study & Comparison')['Genome Copy Number Difference'].mean().reset_index()\nprint(mean_genome_diff)\nfig = plt.figure(figsize=(8, 0.7))\n\nsns.stripplot(data=df_copy_number, y='Study & Comparison', x='Genome Copy Number Difference', jitter=True, alpha=0.6,zorder=1, color='tab:orange')\nsns.pointplot(data=mean_genome_diff, y='Study & Comparison', x='Genome Copy Number Difference', linestyles='none', markers='D', color='#36454F', markersize=5, errorbar=None, zorder=1)\nplt.legend([],[], frameon=False)\n\n\nplt.ylabel('')\nplt.xlabel(u'Genome Copy Number Δ (MT - NT), Logged')\n\nplt.gca().invert_xaxis()\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in -4, -2, 0, 2:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n        continue\n    plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nplt.xticks([-4, -2, 0, 2])\n\n\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Nasopharyngeal', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors Mid-Turbinate', fontsize=10, color='black', ha='center')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\n\nplt.show()\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Study & Comparison  Genome Copy Number Difference\n0  Muller et al. 2021,\\nNasopharyngeal                      -1.354036\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-6-output-2.png){width=745 height=127}\n:::\n:::\n\n\n### Nasal Swabs\n\nNote that the second plot shows the difference in genome copy numbers, rather than CT values[^2].\n\n[^2]: A 1-log difference in genome copy number is equivalent to a 3.3 CT difference. This is because each cycle in a qPCR machine approxiately equates to doubling of the genome copy number.\n\n::: {#f0fb5ff5 .cell execution_count=6}\n``` {.python .cell-code}\ndf = pd.read_csv('data/nasal_ct_differences.tsv', sep='\\t', skiprows=1)\n\ndf.columns = df.columns.str.replace(\", \", \"\\n\")\n# reshape dataframe to long format\ndf = df.melt(var_name='Study & Comparison', value_name='CT Difference')\n\nfig = plt.figure(figsize=(8,1.5))\nsns.stripplot(data=df, y='Study & Comparison', x='CT Difference', hue='Study & Comparison', jitter=True)\nplt.legend([],[], frameon=False)\n# drop y axis label\nplt.ylabel('')\nplt.xlabel(u'SARS-CoV-2 qPCR CT Δ (Nasal - Comparison)')\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\n\nfor x in 5, 0, -5, -10, -15:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n    else:\n        plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nplt.axhline(y=0.5, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Comparison', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors Nasal Swab', fontsize=10, color='black', ha='center')\n\n\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![**Figure 2: Nasal swabs vs Oro-pharyngeal and combined nasal/oro-pharyngeal swabs.** All data is taken from Goodall et al. 2022.](index_files/figure-html/cell-7-output-1.png){width=820 height=186}\n:::\n:::\n\n\n::: {#b6566302 .cell execution_count=7}\n``` {.python .cell-code}\n# All CT difference data was calculated and is taken from https://docs.google.com/spreadsheets/d/1YP4mxT_vxiFwXU5ZuBM4obq_oscfhe05ODWwHFHEznM/\n\ndf = pd.read_csv('data/leung_genome_copy_differences.tsv', sep='\\t', skiprows=1)\n\ndf = df.melt(var_name='Study & Comparison', value_name='Genome Copy Number Difference')\ndf['Study & Comparison'] = df['Study & Comparison'].str.split(',').str[-1]\n\n\nmean_ct_diff = df.groupby('Study & Comparison')['Genome Copy Number Difference'].mean().reset_index()\nprint(mean_ct_diff)\nfig = plt.figure(figsize=(8, 2))\nsns.stripplot(data=df, y='Study & Comparison', x='Genome Copy Number Difference', hue='Study & Comparison', jitter=True, alpha=0.6,zorder=1)\nsns.pointplot(data=mean_ct_diff, y='Study & Comparison', x='Genome Copy Number Difference', linestyles='none', markers='D', color='#36454F', markersize=5, errorbar=None, zorder=1)\nplt.legend([],[], frameon=False)\n# drop y axis label\nplt.ylabel('')\nplt.xlabel(u'Genome Copy Number Δ (Nasal - Throat), Logged')\n# flip x axis\nplt.gca().invert_xaxis()\nplt.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in -2, 0, 2, 4, 6:\n    if x == 0:\n        plt.axvline(x=x, color='red', linestyle='--', alpha=0.5)\n        continue\n    plt.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nfor y in 0.5, 1.5:\n    plt.axhline(y=y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nmin_x, max_x = plt.xlim()\n\nplt.text(max_x/2,-0.6, 'Favors Throat Swab', fontsize=10, color='black', ha='center')\nplt.text(min_x/2,-0.6, 'Favors Nasal Swab', fontsize=10, color='black', ha='center')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().spines['left'].set_visible(False)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Study & Comparison  Genome Copy Number Difference\n0   Human Coronavirus                       2.964545\n1           Influenza                       2.132727\n2          Rhinovirus                       2.565946\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![**Figure 3: Nasal swabs vs Oro-pharyngeal swabs.** All data is taken from Leung et al. 2020.](index_files/figure-html/cell-8-output-2.png){width=760 height=223}\n:::\n:::\n\n\nIn qPCR measurements, nasal swabs contain more virus copies than throat swabs. In (Goodall et al. 2022), nasal swabs are slightly superior to throat swabs and combined/nasal throat swabs, and come out about even when compared to combined nasal/OP swabs. In (Leung et al. 2020), researchers ran multiplex-PCR on both nasal and throat swamples. qPCR differences are plotted in Figure 3 for Human Coronavirus, Influenza, and Rhinovirus.\n\n\n# Virus relative abundance across different swab types\n\nWhatever the sample type, ultimately we will want to perform metagenomic sequencing to detect novel pathogens. As described in a [previous report](https://naobservatory.org/reports/comparing-sampling-strategies-for-early-detection-of-stealth-biothreats/), the value of a metagenomic sequencing sample will can be assessed across several dimensions:\n\n* What is the expected relative abundance of a human-infecting stealth virus?\n* How complex are individual sequencing samples? I.e, what is their species richness and evenness?\n* How much does the background complexity of a sample vary between individuals and over time?\n\n\nThe relative abundance of a target pathogen can be impacted by its microbial background, because the sequencing efficiency of a taxon is directly dependant on the sampling efficiency of the other taxa in the sample[^3]\n\n[^3]: See [McClaren et al. 2019](https://elifesciences.org/articles/46923) for further discussion.\n\nWe identified two studies that performed paired metagenomic sequencing and SARS-CoV-2 qPCR on swab samples Lu et al. 2021, Babiker et al. 2020. We've reached out to the authors of two further studies that didn't have publicly available data.\n\nSome observations:\n\n* Though comparing qPCR values between studies is tricky, we do see the expected difference in CT values, where nasopharyngeal swabs have lower CT values.\n* For the same CT value, Lu et al. 2021 returns higher relative abundance.\n* Outpatients in Lu et al. have slightly higher relative abundances for the same CT value.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n### Other pathogens\n\n#### Influenza A\n\n - Swab samples were received from ambulatory patients with signs of influenza virus infection\n - Samples include 11 swabs, 5 sputum, 7 BAL fluid, 1 tracheal secretion.\n - It might be worth dropping the non-swab samples.\n\n::: {#933da89c .cell execution_count=8}\n``` {.python .cell-code}\ndf_fischer_influenza = pd.read_csv('data/fischer_influenza_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_fischer_influenza.rename(columns={\"FluA CT\":\"flua_ct\", \"Relative Abundance\": \"flua_mgs\"}, inplace=True)\ndf_fischer_influenza['flua_ct'] = df_fischer_influenza[df_fischer_influenza['flua_ct'] != 'Neg']['flua_ct'].astype(int)\n\nprint(df_fischer_influenza[df_fischer_influenza['Sample Type'] == 'Swab']['flua_mgs'])\n\nfig, ax = plt.subplots(1, 1, figsize=(7.5,3))\nax.set_xlim(12.5, 40)\nax.set_ylim(10**-8, 10**0)\nsns.scatterplot(data=df_fischer_influenza, x='flua_ct', y='flua_mgs', hue='Sample Type', style='Sample Type', s=70)\nax.set_xlabel('Influenza A qPCR CT Value')\nax.set_ylabel('Relative Abundance')\nax.set_yscale('log')\nax.invert_xaxis()\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in np.arange(15, 40, 5):\n    ax.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\nfor y in range(-7, 1, 1):\n    log_y = 10**y\n    ax.axhline(y=log_y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\nax.legend(title='', loc=\"center left\", bbox_to_anchor=(1, 0.5), frameon=False)\nplt.show()\nplt.clf()\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n12    0.000004\n13    0.001955\n14    0.000000\n15    0.032113\n16    0.000055\n17    0.000319\n18    0.000000\n19    0.082211\n20    0.000208\n21    0.000192\n22    0.000000\nName: flua_mgs, dtype: float64\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-9-output-2.png){width=754 height=287}\n:::\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 672x480 with 0 Axes>\n```\n:::\n:::\n\n\n#### Influenza A, B, Mumps, and Measles\n\n\n - Various clinical sample types including ones we a ren't interested in (skin, urine, feces)\n - \"respiratory\" swabs, unclear what type of swab\n\n::: {#07e3b839 .cell execution_count=9}\n``` {.python .cell-code}\ndf_huang_various = pd.read_csv('data/huang_resp_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_huang_various[\"relative_abundance\"] = df_huang_various[\"Matches per million reads\"] / 1e6\ndf_huang_influenza = df_huang_various[(df_huang_various[\"Virus\"] == \"Influenza A\") | (df_huang_various[\"Virus\"] == \"Influenza B\")]\nprint(df_huang_influenza[\"relative_abundance\"])\n\nfig, ax = plt.subplots(1,1, figsize=(7.5,3))\nax.set_xlim(12.5, 40)\nax.set_ylim(10**-8, 10**0)\n\nsns.scatterplot(data=df_huang_various, x='CT', y='relative_abundance', hue='Virus', style='Virus', s=70)\nax.set_xlabel('qPCR CT Value')\nax.set_ylabel('Relative Abundance')\nax.set_yscale('log')\nax.invert_xaxis()\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in np.arange(15, 40, 5):\n    ax.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\nfor y in range(-7, 1, 1):\n    log_y = 10**y\n    ax.axhline(y=log_y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nax.legend(title='', loc=\"center left\", bbox_to_anchor=(1, 0.5), frameon=False)\n\nplt.show()\nplt.clf()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0    0.012873\n1    0.000005\n2    0.000165\n3    0.000001\n4    0.000034\n5    0.000000\n6    0.000154\n7    0.000010\n8    0.000025\n9    0.001093\nName: relative_abundance, dtype: float64\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-10-output-2.png){width=765 height=287}\n:::\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 672x480 with 0 Axes>\n```\n:::\n:::\n\n\n#### Rhinovirus, Metapneumovirus, Coronavirus, Respiratory syncytial virus, and Parainfluenza\n\n - Adults\n - NP swabs\n - adults with upper respiratory tract infections\n - outpatients who reported symptoms (participants were part of the VIDARIS trial https://jamanetwork.com/journals/jama/fullarticle/1367547)\n\n::: {#0bf9bdff .cell execution_count=10}\n``` {.python .cell-code}\ndf_thorburn_various = pd.read_csv('data/thorburn_np_ct_mgs.tsv', sep='\\t', skiprows=1)\n\ndef map_virus_names(virus_list):\n    full_name_dict = {\n        \"HCoV\": \"Seasonal Coronavirus\",\n        \"hMPV\": \"Metapneumovirus\",\n        \"HRV\": \"Rhinovirus\",\n        \"PIV\": \"Parainfluenza Virus\",\n        \"RSV\": \"Respiratory Syncytial Virus\",\n        \"Influenza A\": \"Influenza A\",\n        \"N/A\": None\n    }\n\n    def find_full_name(virus):\n        if not isinstance(virus, str):\n            return None\n        for key in full_name_dict:\n            if key in virus:\n                return full_name_dict[key]\n        return virus\n    return [find_full_name(virus) for virus in virus_list]\n\nfor col in [\"Taxonomy\", \"PCR\"]:\n    df_thorburn_various[col] = map_virus_names(df_thorburn_various[col])\n\ndf_thorburn_various = df_thorburn_various[df_thorburn_various[\"Taxonomy\"] == df_thorburn_various[\"PCR\"]]\ndf_thorburn_various[\"relative_abundance\"] = df_thorburn_various[\"% reads mapping\"] / 100\nfig, ax = plt.subplots(1, 1, figsize=(7.5,3))\nax.set_xlim(12.5, 40)\nax.set_ylim(10**-8, 10**0)\nsns.scatterplot(data=df_thorburn_various, x='Ct', y='relative_abundance', hue='Taxonomy', style='Taxonomy', s=70)\nax.set_xlabel('qPCR CT Value')\nax.set_ylabel('Relative Abundance')\nax.set_yscale('log')\nax.invert_xaxis()\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\nfor x in np.arange(15, 40, 5):\n    ax.axvline(x=x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\nfor y in range(-7, 1, 1):\n    log_y = 10**y\n    ax.axhline(y=log_y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nax.legend(title='', loc=\"center left\", bbox_to_anchor=(1, 0.5), frameon=False)\nax.set_title(\"Thorburn et al. 2016 - NP Swabs - Outpatients\", x=0.0, y=1.0, ha='left')\n\nplt.show()\nplt.clf()\n\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-11-output-1.png){width=870 height=302}\n:::\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 672x480 with 0 Axes>\n```\n:::\n:::\n\n\n### Rhinovirus, Metapneumovirus, Respiratory syncytial virus, Influenza A, Influenza B, and Parainfluenza\n - Children under 5\n - nasopharyngeal\n - RNA seq\n - most likely inpatients (most authors work in a pediatrics department)\n\n::: {#31b9b709 .cell execution_count=11}\n``` {.python .cell-code}\ndf_graf_various = pd.read_csv('data/graf_np_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_graf_various.rename(columns={\"Virus\": \"virus\", \"Viral copies/ml\": \"viral_copies_ml\"}, inplace=True)\n\n# create an empty column for relative abundance\ndf_graf_various[\"relative_abundance\"] = None\n\n\n\ndef rpkm_to_ra(df):\n    genome_lengths_in_kb = {\n        \"Influenza A\": 13.5,\n        \"Influenza B\": 14.5,\n        \"Metapneumovirus\": 13.3,\n        \"Rhinovirus\": 7.2,\n        \"Parainfluenzavirus 1\": 15.5,\n        \"Parainfluenzavirus 3\": 15.5,\n        \"Parainfluenzavirus 4\": 17.4,\n        \"Respiratory Syncytial Virus\": 15.2\n    }\n\n\n\n    for virus, virus_length in genome_lengths_in_kb.items():\n        df.loc[df[\"virus\"] == virus, \"relative_abundance\"] = df.loc[df[\"virus\"] == virus, \"RPKM\"] * virus_length / 1e6\n        print(df.loc[df[\"virus\"] == virus])\n\n    # return df as a tsv\n    df.to_csv('data/graf_.tsv', sep='\\t', index=False)\n    return df\n\ndf_graf_various = rpkm_to_ra(df_graf_various)\n\n# summarize parainfluenzavirus columns under \"Parainfluenzavirus\"\ndf_graf_various[\"virus\"] = df_graf_various[\"virus\"].str.replace(r'Parainfluenzavirus \\d', 'Parainfluenzavirus (1,3,4)', regex=True)\n\ndf_graf_influenza = df_graf_various[(df_graf_various[\"virus\"] == \"Influenza A\") | (df_graf_various[\"virus\"] == \"Influenza B\")]\nprint(df_graf_influenza)\n\nfig, ax = plt.subplots(1,1, figsize=(7.5,3))\n\nsns.scatterplot(data = df_graf_various, x='viral_copies_ml', y='relative_abundance', hue='virus', style='virus', s=70)\nax.tick_params(axis='y', which='both', left=False, right=False, labelleft=True)\n\nax.set_yscale('log')\nax.set_xscale('log')\nax.set_ylim(10**-8, 10**0)\nax.set_xlabel('Viral copies per ml')\nax.set_ylabel('Relative Abundance')\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\n\nfor x in np.arange(1, 11,1):\n    log_x = 10**x\n    ax.axvline(x=log_x, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\nfor y in range(-7, 1, 1):\n    log_y = 10**y\n    ax.axhline(y=log_y, color='grey', linestyle='--', alpha=0.5, linewidth=0.5)\n\nax.legend(title='', loc=\"center left\", bbox_to_anchor=(1, 0.5), frameon=False)\nax.set_title(\"Graf et al. 2016 - Nasopharyngeal Swabs - 5yo Inpatients\", x=0.0, y=1.0, ha='left')\n\nplt.show()\nplt.clf()\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   viral_copies_ml        RPKM        virus relative_abundance\n0     4.783721e+06    0.016220  Influenza A                0.0\n1     6.342616e+06    0.064766  Influenza A           0.000001\n2     9.925403e+06    1.272319  Influenza A           0.000017\n3     1.215173e+08    0.862650  Influenza A           0.000012\n4     2.462959e+08    1.092196  Influenza A           0.000015\n5     5.884899e+08    5.520659  Influenza A           0.000075\n6     1.691466e+09    3.936595  Influenza A           0.000053\n7     4.164813e+10  857.744831  Influenza A            0.01158\n    viral_copies_ml       RPKM        virus relative_abundance\n8      1.247008e+07   0.382809  Influenza B           0.000006\n9      1.652153e+07   1.341402  Influenza B           0.000019\n10     1.748424e+08   6.281125  Influenza B           0.000091\n11     3.576995e+08  41.215861  Influenza B           0.000598\n    viral_copies_ml        RPKM            virus relative_abundance\n12     6.536909e+04    0.285328  Metapneumovirus           0.000004\n13     2.899547e+05    0.343206  Metapneumovirus           0.000005\n14     9.457011e+05    1.172959  Metapneumovirus           0.000016\n15     1.599806e+06   21.308341  Metapneumovirus           0.000283\n16     1.475527e+06   13.667489  Metapneumovirus           0.000182\n17     1.092843e+07   29.995030  Metapneumovirus           0.000399\n18     4.254173e+07    3.623086  Metapneumovirus           0.000048\n19     2.434850e+08  144.303644  Metapneumovirus           0.001919\n    viral_copies_ml         RPKM       virus relative_abundance\n20     7.568361e+02     1.020162  Rhinovirus           0.000007\n21     2.629221e+03     0.236696  Rhinovirus           0.000002\n22     6.513821e+03     0.709671  Rhinovirus           0.000005\n23     1.043063e+05     0.173820  Rhinovirus           0.000001\n24     1.809367e+05     0.264165  Rhinovirus           0.000002\n25     1.744501e+05     0.422682  Rhinovirus           0.000003\n26     2.770864e+05     0.114593  Rhinovirus           0.000001\n27     1.050176e+06     0.124141  Rhinovirus           0.000001\n28     1.143380e+05     1.871911  Rhinovirus           0.000013\n29     1.752269e+05     0.925296  Rhinovirus           0.000007\n30     4.857337e+05     1.112330  Rhinovirus           0.000008\n31     2.829710e+06     1.004222  Rhinovirus           0.000007\n32     1.772075e+06     1.446651  Rhinovirus            0.00001\n33     4.539370e+06     1.566408  Rhinovirus           0.000011\n34     5.493833e+06     0.644727  Rhinovirus           0.000005\n35     1.254067e+06     4.807436  Rhinovirus           0.000035\n36     8.878617e+06     3.711617  Rhinovirus           0.000027\n37     9.277201e+06     8.561231  Rhinovirus           0.000062\n38     4.594837e+06    13.334241  Rhinovirus           0.000096\n39     4.126031e+07    16.478090  Rhinovirus           0.000119\n40     5.210808e+07    12.367187  Rhinovirus           0.000089\n41     4.846040e+07    34.243271  Rhinovirus           0.000247\n42     8.774543e+07    99.983545  Rhinovirus            0.00072\n43     1.029963e+08   187.166431  Rhinovirus           0.001348\n44     1.549385e+08  3489.577184  Rhinovirus           0.025125\n45     3.671462e+08  4085.995885  Rhinovirus           0.029419\n46     3.262434e+08  3680.142690  Rhinovirus           0.026497\n47     9.007463e+08  2185.633808  Rhinovirus           0.015737\n48     6.684199e+09  6735.766705  Rhinovirus           0.048498\n    viral_copies_ml        RPKM                 virus relative_abundance\n49     1.044274e+02    0.021328  Parainfluenzavirus 1                0.0\n50     2.585307e+05    0.563628  Parainfluenzavirus 1           0.000009\n51     8.800211e+05    3.605421  Parainfluenzavirus 1           0.000056\n52     2.417283e+07  186.824852  Parainfluenzavirus 1           0.002896\n    viral_copies_ml        RPKM                 virus relative_abundance\n53     2.165299e+05    0.014939  Parainfluenzavirus 3                0.0\n54     2.575307e+02    0.028458  Parainfluenzavirus 3                0.0\n55     3.590323e+07  368.593093  Parainfluenzavirus 3           0.005713\n56     3.065953e+07  299.036046  Parainfluenzavirus 3           0.004635\n57     1.512901e+07  242.437455  Parainfluenzavirus 3           0.003758\n    viral_copies_ml      RPKM                 virus relative_abundance\n58     7.738129e+04  2.366742  Parainfluenzavirus 4           0.000041\n59     1.760825e+06  0.470595  Parainfluenzavirus 4           0.000008\n    viral_copies_ml         RPKM                        virus   \n60     1.098243e+09  3320.170462  Respiratory Syncytial Virus  \\\n61     7.018202e+07   786.749607  Respiratory Syncytial Virus   \n62     5.301194e+06  1190.960101  Respiratory Syncytial Virus   \n63     3.377650e+05   167.389667  Respiratory Syncytial Virus   \n64     1.858023e+08   284.462715  Respiratory Syncytial Virus   \n65     1.097060e+07    59.149005  Respiratory Syncytial Virus   \n66     2.770203e+06    23.671117  Respiratory Syncytial Virus   \n67     3.124786e+04     0.853710  Respiratory Syncytial Virus   \n\n   relative_abundance  \n60           0.050467  \n61           0.011959  \n62           0.018103  \n63           0.002544  \n64           0.004324  \n65           0.000899  \n66            0.00036  \n67           0.000013  \n    viral_copies_ml        RPKM        virus relative_abundance\n0      4.783721e+06    0.016220  Influenza A                0.0\n1      6.342616e+06    0.064766  Influenza A           0.000001\n2      9.925403e+06    1.272319  Influenza A           0.000017\n3      1.215173e+08    0.862650  Influenza A           0.000012\n4      2.462959e+08    1.092196  Influenza A           0.000015\n5      5.884899e+08    5.520659  Influenza A           0.000075\n6      1.691466e+09    3.936595  Influenza A           0.000053\n7      4.164813e+10  857.744831  Influenza A            0.01158\n8      1.247008e+07    0.382809  Influenza B           0.000006\n9      1.652153e+07    1.341402  Influenza B           0.000019\n10     1.748424e+08    6.281125  Influenza B           0.000091\n11     3.576995e+08   41.215861  Influenza B           0.000598\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-12-output-2.png){width=870 height=303}\n:::\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 672x480 with 0 Axes>\n```\n:::\n:::\n\n\n# Simulating detection capability\n\nWe can use the above data to replicate research by Jeff Kaufman. Let's say we get a random set of swabs from a population which contains 1% sick people. On average 1% of all swabs will return positive, and the relative abundance in that positive sample is picked randomly among the relative abundances given in Lu et al. 2021 and Babiker et al. 2020, respectively.\n\nBased on this, the median RA(1%) in a pooled sample with 200 swabs is ~ 10^-4.8 Lu et al. 2021 (throat swabs) and 10^-5.9 in Babiker et al. 2020 (NP swabs)\n\n::: {#965706e8 .cell execution_count=12}\n``` {.python .cell-code}\ndef simulate_detection(positive_ras):\n    FRAC_SICK = 0.01\n    SIMULATIONS = 10000\n\n    def probabilistic_round(x):\n        return int(math.floor(x + random.random()))\n\n    def simulate_once(n_swabs):\n        n_sick = probabilistic_round(FRAC_SICK*n_swabs)\n        if not n_sick:\n            return 0\n        ra = 0\n        for _ in range(n_sick):\n            ra += random.choice(positive_ras)\n        return ra / n_swabs\n\n    def simulate_many(n_simulations, n_swabs):\n        RAs = []\n        for _ in range(n_simulations):\n            RAs.append(simulate_once(n_swabs))\n        RAs.sort()\n\n        return [RAs[probabilistic_round(len(RAs)*percentile/100)]\n                for percentile in range(100)]\n    data = defaultdict(list)\n    n_swab_range = [50, 100, 200, 400, 800]\n    for n_swabs in n_swab_range:\n        for percentile, ra in enumerate(simulate_many(SIMULATIONS, n_swabs)):\n            data[percentile].append(ra)\n    df = pd.DataFrame(data).T\n    df.columns = n_swab_range\n\n    return df\ndf_op_lu = pd.read_csv('data/lu_throat_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_op_lu.rename(columns={'SCV-2 Relative Abundance': 'scv2_ra', 'Ct value': 'scv2_ct'}, inplace=True)\n\ndf_np_various_thorburn = pd.read_csv('data/thorburn_np_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_np_various_thorburn['relative_abundance'] = df_np_various_thorburn[\"% reads mapping\"] / 100\ndf_np_various_graf = pd.read_csv('data/graf_np_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_np_various_graf.rename(columns={\"Virus\": \"virus\", \"Viral copies/ml\": \"viral_copies_ml\"}, inplace=True)\n\n\n\n# create an empty column for relative abundance\ndf_np_various_graf[\"relative_abundance\"] = None\n\ndef rpkm_to_ra(df):\n    genome_lengths_in_kb = {\n        \"Influenza A\": 13.5,\n        \"Influenza B\": 14.5,\n        \"Metapneumovirus\": 13.3,\n        \"Rhinovirus\": 7.2,\n        \"Parainfluenzavirus 1\": 15.5,\n        \"Parainfluenzavirus 3\": 15.5,\n        \"Parainfluenzavirus 4\": 17.4,\n        \"Respiratory Syncytial Virus\": 15.2\n    }\n\n\n\n    for virus, virus_length in genome_lengths_in_kb.items():\n        df.loc[df[\"virus\"] == virus, \"relative_abundance\"] = df.loc[df[\"virus\"] == virus, \"RPKM\"] * virus_length / 1e6\n\n    return df\ndf_np_various_graf = rpkm_to_ra(df_np_various_graf)\n\ndf_np_babiker = pd.read_csv('data/babiker_np_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_np_babiker.rename(columns={'SARS-CoV-2 RT-PCR Ct': 'scv2_ct', 'SARS-CoV-2 RA': 'scv2_ra', 'Inpatient/ED vs. Outpatient': 'patient_status'}, inplace=True)\ndf_np_babiker['scv2_ct'] = df_op_lu['scv2_ct'].replace(',', '.', regex=True).astype(float)\n\ndf_op_lu_ras = df_op_lu['scv2_ra'].dropna().tolist()\ndf_np_babiker_ras = df_np_babiker['scv2_ra'].dropna().tolist()\ndf_np_various_thorburn_ras = df_np_various_thorburn['relative_abundance'].dropna().tolist()\ndf_np_various_graf_ras = df_np_various_graf['relative_abundance'].dropna().tolist()\n\ndf_np_mostafa = pd.read_csv('data/mostafa_np_scv2_ct_mgs.tsv', sep='\\t', skiprows=1)\ndf_np_mostafa.rename(columns={'SARS-CoV-2 RT-PCR Ct': 'scv2_ct', 'SARS-CoV-2 RA': 'scv2_ra', 'Severity Index': 'severity_index'}, inplace=True)\ndf_np_mostafa['scv2_ct'] = df_np_mostafa['scv2_ct'].replace(',', '.', regex=True).astype(float)\ndf_np_mostafa_ras = df_np_mostafa['scv2_ra'].dropna().tolist()\n\n\n\nfig, axs = plt.subplots(2, 3, figsize=(15, 9), sharey=True)\nn_swab_range = [50, 100, 200, 400, 800]\nstudies = [\"Lu\",\"Babiker\", \"Mostafa\", \"Thorburn\", \"Graf\"]\nfor i, (study, positive_ras) in enumerate(zip(studies, [df_op_lu_ras, df_np_babiker_ras, df_np_mostafa_ras, df_np_various_thorburn_ras, df_np_various_graf_ras])):\n    ax = axs[i // 3, i % 3]  # Calculate the correct subplot position\n    df = simulate_detection(positive_ras)\n    for n_swabs in n_swab_range:\n        ax.plot(df.index, df[n_swabs], label=f'{n_swabs} swabs')\n    ax.set_xlabel('Percentile')\n    ax.set_ylabel('RA')\n    ax.set_yscale('log')\n    # turn on y tick labels for both plots\n    ax.yaxis.set_tick_params(labelleft=True)\n    for x in range(0, 100, 20):\n        ax.axvline(x=x, color='black', linestyle='--', linewidth=0.5, alpha=0.5)\n\n    for y in range(-1, -10, -1):\n        log_y = 10**y\n        ax.axhline(y=log_y, color='black', linestyle='--', linewidth=0.5, alpha=0.5)\n    if study == \"Lu\":\n        ax.set_title('Oropharyngeal, SARS-CoV-2, Inpatients', fontsize=10)\n    elif study == \"Babiker\":\n        ax.set_title('Nasopharyngeal, SARS-CoV-2, Inpatients & Outpatients', fontsize=10)\n    elif study == \"Thorburn\":\n        ax.set_title('Nasopharyngeal, Various Pathogens, Outpatients', fontsize=10)\n    elif study == \"Graf\":\n        ax.set_title('Nasopharyngeal, Various Pathogens, 5yo Inpatients', fontsize=10)\n    elif study == \"Mostafa\":\n        ax.set_title('Nasal, SARS-CoV-2, Inpatients & Outpatients', fontsize=10)\n\n    ax.spines['right'].set_visible(False)\n    ax.spines['top'].set_visible(False)\n    ax.tick_params(axis='x', which='both', bottom=False, top=False, labelbottom=True)\n    if i == 3:  # Only add legend to the last plot\n        handles, labels = ax.get_legend_handles_labels()\n        fig.legend(handles, labels, loc='upper center', bbox_to_anchor=(0.5, 0.05), ncol=5)\n```\n\n::: {.cell-output .cell-output-display}\n![**Figure 5: Simulated detection capability of pooled swab sampling.**\nLeft Figure: Throat Swabs. Data from Lu et al. 2021.\nRight Figure: Nasopharyngeal Swabs. Data from Babiker et al. 2020.](index_files/figure-html/cell-13-output-1.png){width=1205 height=785}\n:::\n:::\n\n\n## Next steps\n* Pull in additional qPCR studies.\n* Read into research on comparing CT values across studies and search for standard curves in existing papers.\n* Lay out what you would do if you had standard curves available.\n\nCreate a figure for the remaining viruses not covered in Figure 3.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}